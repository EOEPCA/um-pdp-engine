[![Contributors][contributors-shield]][contributors-url]
[![Forks][forks-shield]][forks-url]
[![Stargazers][stars-shield]][stars-url]
[![Issues][issues-shield]][issues-url]
[![MIT License][license-shield]][license-url]
![Build][build-shield]

<!-- PROJECT LOGO -->
<br />
<p align="center">
  <a href="https://github.com/EOEPCA/um-pdp-engine">
    <img src="images/logo.png" alt="Logo" width="80" height="80">
  </a>

  <h3 align="center">um-pdp-engine</h3>

  <p align="center">
    Policy Decision Point for EOEPCA project
    <br />
    <a href="https://eoepca.github.io/um-pdp-engine/"><strong>Explore the docs »</strong></a>
    <br />
    <a href="https://github.com/EOEPCA/um-pdp-engine/issues">Report Bug</a>
    ·
    <a href="https://github.com/EOEPCA/um-pdp-engine/issues">Request Feature</a>
  </p>
</p>

## Table of Contents

- [Table of Contents](#table-of-contents)
  - [Built With](#built-with)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
- [Dependencies](#dependencies)
- [Configuration](#configuration)
- [Usage & functionality](#usage--functionality)
- [Developer documentation](#developer-documentation)
  - [Demo functionality](#demo-functionality)
  - [Endpoints](#endpoints)
  - [Resources cache](#resources-cache)
- [Roadmap](#roadmap)
- [Contributing](#contributing)
- [License](#license)
- [Contact](#contact)
- [Acknowledgements](#acknowledgements)

<!-- ABOUT THE PROJECT -->

### Built With

- [Python](https://www.python.org//)
- [YAML](https://yaml.org/)
- [Travis CI](https://travis-ci.com/)
- [Docker](https://docker.com)
- [Kubernetes](https://kubernetes.io)

<!-- GETTING STARTED -->

## Getting Started

To get a local copy up and running follow these simple steps.

### Prerequisites

This is an example of how to list things you need to use the software and how to install them.

- [Docker](https://www.docker.com/)
- [Python](https://www.python.org//)

### Installation

1. Get into EOEPCA's development environment

```sh
vagrant ssh
```

3. Clone the repo

```sh
git clone https://github.com/EOEPCA/um-pdp-engine.git
```

4. Change local directory

```sh
cd um-pep-engine
```
## Dependencies
The PDP is written and tested for python 3.6.9, and has all dependencies listed in src/requirements.txt

## Configuration

## Usage & functionality

## Developer documentation
The API will expose an endpoint to interact with the policies.
The main endpoints for the policy operations exposed by the API are now secured with OAuth/OIDC, it would accept both OAuth access_token and JWT id_token in order to authorize the user and both are expected on the header.
This check will retrieve the UUID for the user and insert it on the data model of the policy storage, so when any call is made against a policy, the API will double check if the UUID of the requester matches the one associated to the policy in order to operate against it.

--------

Testing and Demo:

The token can be generated by the oidc library.

For the endpoint:  <DOMAIN>/policy

  Register Policy (PUT/POST):

    curl -k -v -XPOST 'http://<DOMAIN>/policy/' -H 'Content-Type: application/json, Authorization: Bearer <OAuth access_token or JWT id_token>' -d '{"name":"NewPolicy","description":"Description for this new policy","config":{"resource_id":"6666666","rules":[{"AND":[{"EQUAL":{"user_name":"admin"}}]}]},"scopes":["oidc"]}'

This will return te policy_id for the policy just created (i.e: 5f32f236ea1bacfddd396e97)

For the endpoint: <DOMAIN>/policy/<policy_id or ObjectId(policy_id)>

  Update Policy (PUT/POST):

    curl -k -v -XPOST 'http://<DOMAIN>/policy/5f32f236ea1bacfddd396e97' -H 'Content-Type: application/json, Authorization: Bearer <OAuth access_token or JWT id_token>' -d '{"name":"NewPolicyChanged","description":"Description for this new policy changed","config":{"resource_id":"6666666","rules":[{"AND":[{"EQUAL":{"user_name":"admin"}}]}]},"scopes":["Authorized"]}'
    curl -k -v -XPUT 'http://<DOMAIN>/policy/ObjectId(5f32f236ea1bacfddd396e97)' -H 'Content-Type: application/json, Authorization: Bearer <OAuth access_token or JWT id_token>' -d '{"name":"NewPolicyChanged","description":"Description for this new policy changed","config":{"resource_id":"6666666","rules":[{"AND":[{"EQUAL":{"user_name":"admin"}}]}]},"scopes":["Authorized"]}'

  Get Policy (GET):

  By its _id:

    curl -k -v -XGET 'http://<DOMAIN>/policy/5f32f236ea1bacfddd396e97' -H 'Content-Type: application/json, Authorization: Bearer <token>'

  By its resource_id:

    curl -k -v -XGET 'http://<DOMAIN>/policy/5f339a1e8e8f28850cb2e6e7' -H 'Content-Type: application/json, Authorization: Bearer <token>' -d '{"resource_id": "6666666"'

  Delete Policy (DELETE):
  
    curl -k -v -XDELETE 'http://<DOMAIN>/policy/5f32f236ea1bacfddd396e97' -H 'Content-Type: application/json, Authorization: Bearer <token>'

## Roadmap

See the [open issues](https://github.com/EOEPCA/um-pdp-engine/issues) for a list of proposed features (and known issues).


## Contributing

Contributions are what make the open source community such an amazing place to be learn, inspire, and create. Any contributions you make are **greatly appreciated**.

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

<!-- LICENSE -->

## License

Distributed under the Apache-2.0 License. See `LICENSE` for more information.

## Contact

[EOEPCA mailbox](eoepca.systemteam@telespazio.com)

Project Link: [https://github.com/EOEPCA/um-pdp-engine](https://github.com/EOEPCA/um-pdp-engine)

## Acknowledgements

- README.md is based on [this template](https://github.com/othneildrew/Best-README-Template) by [Othneil Drew](https://github.com/othneildrew).


[contributors-shield]: https://img.shields.io/github/contributors/EOEPCA/um-pdp-engine.svg?style=flat-square
[contributors-url]: https://github.com/EOEPCA/um-pdp-engine/graphs/contributors
[forks-shield]: https://img.shields.io/github/forks/EOEPCA/um-pdp-engine.svg?style=flat-square
[forks-url]: https://github.com/EOEPCA/um-pdp-engine/network/members
[stars-shield]: https://img.shields.io/github/stars/EOEPCA/um-pdp-engine.svg?style=flat-square
[stars-url]: https://github.com/EOEPCA/um-pdp-engine/stargazers
[issues-shield]: https://img.shields.io/github/issues/EOEPCA/um-pdp-engine.svg?style=flat-square
[issues-url]: https://github.com/EOEPCA/um-pdp-engine/issues
[license-shield]: https://img.shields.io/github/license/EOEPCA/um-pdp-engine.svg?style=flat-square
[license-url]: https://github.com/EOEPCA/um-pdp-engine/blob/master/LICENSE
[build-shield]: https://www.travis-ci.com/EOEPCA/um-pdp-engine.svg?branch=master
